<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistiques - Livraison Express</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-danger">
        <div class="container-fluid">
            <a class="navbar-brand" href="dashboard-admin.html">
                <i class="bi bi-shield-check me-2"></i>Livraison Express
            </a>
            <button class="navbar-toggler" type="button" onclick="toggleSidebar()">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="#" onclick="authManager.logout()">
                    <i class="bi bi-box-arrow-right me-1"></i>Déconnexion
                </a>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="sidebar-overlay" onclick="toggleSidebar()"></div>
            <nav class="col-md-3 col-lg-2 sidebar p-0" data-role="admin">
                <div class="p-3">
                    <h6 class="text-muted text-uppercase small mb-3">Menu Admin</h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="dashboard-admin.html">
                                <i class="bi bi-speedometer2"></i>Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="manage-users.html">
                                <i class="bi bi-people"></i>Gestion utilisateurs
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="statistics.html">
                                <i class="bi bi-graph-up"></i>Statistiques
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 py-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1 class="h3">Statistiques & Supervision</h1>
                </div>

                <!-- Statistiques globales -->
                <div class="row mb-4">
                    <div class="col-md-3 mb-3">
                        <div class="card stat-card">
                            <div class="card-body">
                                <h6 class="text-muted mb-2">Total commandes</h6>
                                <h3 class="mb-0" id="totalCommands">0</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card stat-card success">
                            <div class="card-body">
                                <h6 class="text-muted mb-2">Terminées</h6>
                                <h3 class="mb-0 text-success" id="completedCommands">0</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card stat-card warning">
                            <div class="card-body">
                                <h6 class="text-muted mb-2">En cours</h6>
                                <h3 class="mb-0 text-warning" id="processingCommands">0</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card stat-card danger">
                            <div class="card-body">
                                <h6 class="text-muted mb-2">Annulées</h6>
                                <h3 class="mb-0 text-danger" id="cancelledCommands">0</h3>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Graphiques (simulation) -->
                <div class="row mb-4">
                    <div class="col-md-6 mb-3">
                        <div class="card">
                            <div class="card-header bg-white">
                                <h5 class="mb-0"><i class="bi bi-bar-chart me-2"></i>Commandes par statut</h5>
                            </div>
                            <div class="card-body">
                                <div id="statusChart" style="height: 300px; display: flex; align-items: center; justify-content: center; background: #f8f9fa; border-radius: 8px;">
                                    <div class="text-center text-muted">
                                        <i class="bi bi-graph-up fs-1 mb-2"></i>
                                        <p class="mb-0">Graphique de répartition</p>
                                        <small>(Simulation - Intégrer Chart.js en production)</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="card">
                            <div class="card-header bg-white">
                                <h5 class="mb-0"><i class="bi bi-calendar me-2"></i>Évolution temporelle</h5>
                            </div>
                            <div class="card-body">
                                <div id="timelineChart" style="height: 300px; display: flex; align-items: center; justify-content: center; background: #f8f9fa; border-radius: 8px;">
                                    <div class="text-center text-muted">
                                        <i class="bi bi-graph-up-arrow fs-1 mb-2"></i>
                                        <p class="mb-0">Graphique d'évolution</p>
                                        <small>(Simulation - Intégrer Chart.js en production)</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Détails par statut -->
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="card">
                            <div class="card-header bg-white">
                                <h5 class="mb-0"><i class="bi bi-list-ul me-2"></i>Répartition des commandes</h5>
                            </div>
                            <div class="card-body">
                                <div id="statusBreakdown">
                                    <!-- Will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="card">
                            <div class="card-header bg-white">
                                <h5 class="mb-0"><i class="bi bi-people me-2"></i>Activité par rôle</h5>
                            </div>
                            <div class="card-body">
                                <div id="roleActivity">
                                    <!-- Will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            loadStatistics();
        });

        function loadStatistics() {
            const commands = getCommands();
            const offers = getOffers();
            
            // Statistiques globales
            const total = commands.length;
            const completed = commands.filter(c => c.status === 'completed').length;
            const processing = commands.filter(c => c.status === 'processing' || c.status === 'shipped').length;
            const cancelled = commands.filter(c => c.status === 'cancelled').length;
            const pending = commands.filter(c => c.status === 'pending').length;
            
            document.getElementById('totalCommands').textContent = total;
            document.getElementById('completedCommands').textContent = completed;
            document.getElementById('processingCommands').textContent = processing;
            document.getElementById('cancelledCommands').textContent = cancelled;
            
            // Répartition par statut
            const statusBreakdown = document.getElementById('statusBreakdown');
            statusBreakdown.innerHTML = `
                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-1">
                        <span>Terminées</span>
                        <span><strong>${completed}</strong> (${total > 0 ? Math.round(completed/total*100) : 0}%)</span>
                    </div>
                    <div class="progress" style="height: 20px;">
                        <div class="progress-bar bg-success" style="width: ${total > 0 ? completed/total*100 : 0}%"></div>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-1">
                        <span>En cours</span>
                        <span><strong>${processing}</strong> (${total > 0 ? Math.round(processing/total*100) : 0}%)</span>
                    </div>
                    <div class="progress" style="height: 20px;">
                        <div class="progress-bar bg-warning" style="width: ${total > 0 ? processing/total*100 : 0}%"></div>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-1">
                        <span>En attente</span>
                        <span><strong>${pending}</strong> (${total > 0 ? Math.round(pending/total*100) : 0}%)</span>
                    </div>
                    <div class="progress" style="height: 20px;">
                        <div class="progress-bar bg-info" style="width: ${total > 0 ? pending/total*100 : 0}%"></div>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-1">
                        <span>Annulées</span>
                        <span><strong>${cancelled}</strong> (${total > 0 ? Math.round(cancelled/total*100) : 0}%)</span>
                    </div>
                    <div class="progress" style="height: 20px;">
                        <div class="progress-bar bg-danger" style="width: ${total > 0 ? cancelled/total*100 : 0}%"></div>
                    </div>
                </div>
            `;
            
            // Activité par rôle
            const clients = new Set(commands.map(c => c.clientId));
            const deliverers = new Set();
            commands.forEach(cmd => {
                if (cmd.acceptedOffer && cmd.acceptedOffer.delivererId) {
                    deliverers.add(cmd.acceptedOffer.delivererId);
                }
            });
            
            document.getElementById('roleActivity').innerHTML = `
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span><i class="bi bi-person text-primary me-2"></i>Clients actifs</span>
                        <span class="badge bg-primary">${clients.size}</span>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span><i class="bi bi-bicycle text-success me-2"></i>Livreurs actifs</span>
                        <span class="badge bg-success">${deliverers.size}</span>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span><i class="bi bi-envelope-paper text-info me-2"></i>Total offres</span>
                        <span class="badge bg-info">${offers.length}</span>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span><i class="bi bi-check-circle text-success me-2"></i>Offres acceptées</span>
                        <span class="badge bg-success">${commands.filter(c => c.acceptedOffer).length}</span>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>

